<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Label Sample</title>
    <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="async.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" crossorigin="anonymous">
    <style media="screen">
      button {
        margin: 0px 20px;
        padding: 10px 60px !important;
      }
    </style>
    <script type="text/javascript">
      var targetlist;
      var current = 0;
      async.waterfall([
        function(callback){
          $.getJSON( "data.json", function( data ) {
            targetlist = data;
            callback(null);
          });
        },
        function(callback){
          updateProgress(current,targetlist.targetname.length);
          labeling(current);
          callback(null);
        }
      ])

      function labeling( index ){
        $("#target-img").attr( "src" ,"http://140.119.164.249/test/ml20160525/" + targetlist.targetname[index] + ".PNG" );
        $("#target-link").attr( "href" ,"http://140.119.164.249/test/ml20160525/viewmodel.php?file=" + targetlist.targetname[index] + ".stl" );
        $("#model").val(targetlist.targetname[index]);
      }

      function updateProgress( now, total ){
        $("#progress").html(now+1 + " / " + total);
      }

      function nextTarget(){
        current++;
        updateProgress(current,targetlist.targetname.length);
        labeling(current);
      }

      $(function() {

        alert("已啟用快速功能，方向左鍵是劣，方向下鍵是普通，方向右鍵是優");

        $("#next").click(function() {
          current++;
          if(current>=targetlist.targetname.length) {
            alert("已經全部標記完畢");
          }
          else {
            updateProgress(current,targetlist.targetname.length);
            labeling(current);
          }
        })

        $("#ans-O").click(function() {
          if($("#name").val()==""){
            alert("請先填寫姓名");
          }
          else{
            $("#ans").val("2");
            $("#next").click();
          }
        });

        $("#ans-X").click(function() {
          if($("#name").val()==""){
            alert("請先填寫姓名");
            return;
          }
          else {
            $("#ans").val("0");
            $("#next").click();
          }
        });

       $("#ans-D").click(function() {
          if($("#name").val()==""){
            alert("請先填寫姓名");
            return;
          }
          else {
            $("#ans").val("1");
            $("#next").click();
          }
        });

        $(document).keydown(function(e) {
            switch(e.which) {
                case 37: // left
//                $("#ans-O").click();
                $("#ans-X").click();
                break;

                case 38: // up
                break;

                case 39: // right
//                $("#ans-X").click();
                $("#ans-O").click();
                break;

                case 40: // down
                $("#ans-D").click();
                break;

                default: return; // exit this handler for other keys
            }bl
            e.preventDefault(); // prevent the default action (scroll / move caret)
        });
      });


    </script>
  </head>
  <body>
    <div class="text-center">
      <h1 id="progress"></h1>
    </div>
    <div style="padding:10px 25%">
      <a id="target-link" href="" target="_blank">
        <img id="target-img" width="100%" src="" alt="" />
      </a>
    </div>
    <div class="text-center" id="form">
      <script type="text/javascript">var submitted=false;</script>
    	<iframe name="hidden_iframe" id="hidden_iframe"
    	style="display:none;" onload="if(submitted){}"></iframe>
      <form class="" action="https://docs.google.com/forms/d/1pg1ZNUoc-P4ReL6m_sJ8wM7Dgoz-O1v7E4lBmzUPc1E/formResponse" method="post" target="hidden_iframe" onsubmit="submitted=true;">
        <label for="name" style="font-size:24px">姓名：</label>
        <input type="text" name="entry.1879561485" value="" id="name" style="font-size:24px">
        <input type="text" name="entry.2099140140" value="" id="model" class="hidden">
        <input type="text" name="entry.417142782" value="" id="ans" class="hidden">
        <div class="text-center" style="padding:10px">
          <button type="button" name="button" class="btn btn-lg btn-danger" id="ans-X">劣</button>
          <button type="button" name="button" class="btn btn-lg btn-success" id="ans-D">普通</button>
          <button type="button" name="button" class="btn btn-lg btn-success" id="ans-O">優</button>
        </div>
        <button type="submit" name="button" id="next" class="hidden">Next</button>
      </form>
    </div>
  </body>
</html>
